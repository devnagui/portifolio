package br.com.devnagui.project.email.facade;

import java.net.URL;
import java.util.ArrayList;
import java.util.Properties;

import org.apache.log4j.Logger;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.unitils.UnitilsJUnit4TestClassRunner;
import org.unitils.inject.annotation.InjectIntoByType;
import org.unitils.inject.annotation.TestedObject;

import br.com.devnagui.project.email.facade.EmailFacade;
import br.com.devnagui.project.email.vo.EmailVO;
import br.com.devnagui.project.manager.exception.BusinessException;

@RunWith(UnitilsJUnit4TestClassRunner.class)
public class EmailFacadeTest {
    private static final Logger LOG = Logger.getLogger(EmailFacadeTest.class);

    @InjectIntoByType( target = "emailFacade")
    private Properties properties = null;
    
    {
        properties= new Properties();
        try {
            URL url = ClassLoader.getSystemResource("mail.properties");
            LOG.info("Carregando properties.");
            properties.load(url.openStream());
        } catch (Exception e) {
          LOG.error(e.getMessage(),e);
        }
    }

    @TestedObject
    private EmailFacade emailFacade;

    
    @Test
    public void enviarEmailSucessoTest() throws BusinessException {
        EmailVO emailVO = new EmailVO();
        ArrayList<String> destinatarios = new ArrayList<String>();
        
        destinatarios.add("nathan.azevedo@sefaz.ce.gov.br");
        emailVO.setDestinatarios(destinatarios);
        emailVO.setAssunto("TESTE");
        emailVO.setMensagem(new StringBuilder("TESTE"));
        
        emailVO.setEnderecoServidorEmail(properties.getProperty("mail.smtp.roteiro.host"));
        emailVO.setPorta(properties.getProperty("mail.smtp.roteiro.port"));
        emailVO.setRemetente(properties.getProperty("mail.roteiro.from"));
        
        emailFacade.enviarMensagem(emailVO);
    }
}
