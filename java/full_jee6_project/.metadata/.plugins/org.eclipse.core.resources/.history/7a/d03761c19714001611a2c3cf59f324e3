package br.com.devnagui.project.email.strategy;

import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;
import java.util.Properties;

import javax.inject.Inject;

import br.com.devnagui.project.email.vo.EmailVO;
import br.com.devnagui.project.entities.PostoCombustivel;
import br.com.devnagui.project.entities.Roteiro;
import br.com.devnagui.project.util.factory.PropertiesResource;

public class EmailFormatarImpl  implements EmailFormater {
	
	private static final long serialVersionUID = 1288905375042722703L;
	
	@Inject
	@PropertiesResource(name = "mail.properties", loader = "")
	private Properties properties;
	
	@Override
	public EmailVO formatarEmailInclusaoRoteiro(Roteiro roteiro) {
		EmailVO emailVO = adcionarConfiguracoesPadroes();
    	List<String> destinatarios = new ArrayList<String>();
    	//FIXME wesley - Alterar o email
    	destinatarios.add(roteiro.getFiscal().getUsuario().getMatricula()+"@email.com");
    	destinatarios.add("nathan.azevedo@email.com");
        emailVO.setDestinatarios(destinatarios);
        emailVO.setAssunto("O roteiro " + roteiro.getId() + " lhe foi atribuido.");
        StringBuilder conteudo = formataCorpoPadraoRoteiro(roteiro);
        emailVO.setMensagem(conteudo);
		return emailVO;
	}

	@Override
	public EmailVO formatarEmailAlteracaoRoteiro(Roteiro roteiro) {
		EmailVO emailVO = adcionarConfiguracoesPadroes();
    	List<String> destinatarios = new ArrayList<String>();
    	//FIXME wesley - Alterar o email
    	destinatarios.add(roteiro.getFiscal().getUsuario().getMatricula() + "@email.com");
    	destinatarios.add("nathan.azevedo@email.com");
        emailVO.setDestinatarios(destinatarios);
        emailVO.setAssunto("O roteiro " + roteiro.getId() + " Alterado.");
        StringBuilder conteudo = formataCorpoPadraoRoteiro(roteiro);
        emailVO.setMensagem(conteudo);
		return emailVO;
	}

	@Override
	public EmailVO formatarEmailExclusaoRoteiro(Roteiro roteiro) {
		EmailVO emailVO = adcionarConfiguracoesPadroes();
    	List<String> destinatarios = new ArrayList<String>();
    	//FIXME wesley - Alterar o email
    	destinatarios.add(roteiro.getFiscal().getUsuario().getMatricula() + "@sefaz.ce.gov.br");
    	destinatarios.add("wesllhey.holanda@sefaz.ce.gov.br");
    	destinatarios.add("nathan.azevedo@sefaz.ce.gov.br");
        emailVO.setDestinatarios(destinatarios);
        emailVO.setAssunto("O roteiro " + roteiro.getId() + " n�o est� mais atribu�do a voc�. Favor desconsider�-lo.");
        StringBuilder conteudo = new StringBuilder();
        conteudo = formataCorpoPadraoRoteiro(roteiro);
        emailVO.setMensagem(conteudo);
        return emailVO;
	}

	@Override
	public StringBuilder formataCorpoPadraoRoteiro(Roteiro roteiro) {
		StringBuilder conteudo = new StringBuilder();
		conteudo.append("---------------Rota-------------------------------");
        conteudo.append("<br />");
        conteudo.append(roteiro.getRotaVersao().getRota().getNome());
        conteudo.append("<br />");
        conteudo.append("---------------Postos Combustiveis----------------");
        conteudo.append("<br />");
		if (roteiro.getRotaVersao().getPostoCombustiveis().size() > 0) {
			for (PostoCombustivel postoCombustivel : roteiro.getRotaVersao().getPostoCombustiveis()) {
				conteudo.append("-"+ postoCombustivel.getContribuinte().getRazaoSocial() + ", " + postoCombustivel.getContribuinte().getEnderecoComum());
				conteudo.append("<br />");
			}
		}
        conteudo.append("--------------------------------------------------");
        conteudo.append("<br />");
        SimpleDateFormat formatarData = new SimpleDateFormat("dd/MM/yyyy");  
        conteudo.append("Data inicial: " + formatarData.format(roteiro.getDataInicial()) + " Data Final: " + formatarData.format(roteiro.getDataFim()));
		return conteudo;
	}
	
	private EmailVO adcionarConfiguracoesPadroes() {
		EmailVO emailVO = new EmailVO();
		emailVO.setEnderecoServidorEmail(properties.getProperty("mail.smtp.roteiro.host"));
        emailVO.setPorta(properties.getProperty("mail.smtp.roteiro.port"));
        emailVO.setRemetente(properties.getProperty("mail.roteiro.from"));
        return emailVO;
	}
}
