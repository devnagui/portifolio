package br.com.devnagui.project.importaranp;

import static org.junit.Assert.fail;

import java.io.File;

import junit.framework.Assert;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebDriverBackedSelenium;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.firefox.FirefoxDriver;

import com.thoughtworks.selenium.Selenium;

public class ImpotacaoDadosAnpSystemTest {
	
	private Selenium selenium;
	
	private WebDriver driver;

	@Before
	public void setUp() throws Exception {
		driver = new FirefoxDriver();
		String baseUrl = "http://localhost:8081/";
		selenium = new WebDriverBackedSelenium(driver, baseUrl);
	}
	
	@Test
	public void testeConsultarUltimaImportacao() {
		selenium.open("/project/paginas/importacaoDadosAnp.xhtml");
		WebElement btnConsultarUltimaImporTacao = driver.findElement(By.id("form:btnConsultarUltimaImportacao"));
		btnConsultarUltimaImporTacao.click();
		selenium.waitForPageToLoad("30000");
	}

	@Test
	public void testeUpload() throws Exception {
		selenium.open("/project/paginas/importacaoDadosAnp.xhtml");
		selenium.type("css=input.rf-fu-inp", getPathXLS());
		selenium.click("css=span.rf-fu-btn-cnt-upl");
		File file = new File(getPathXLS());
		boolean fileExistente = true;
		if (file.length() ==  0) {
			fileExistente = false;
		}
		Assert.assertEquals(true, fileExistente);
		selenium.click("id=form:visualizar");
		selenium.waitForPageToLoad("30000");	
		selenium.click("id=form:salvar");
		selenium.waitForPageToLoad("30000");	
	}

	@After
	public void tearDown() throws Exception {
		selenium.stop();
	}
	
	private String getPathXLS() {
		String PATH_XLS = System.getProperty("user.dir");
		return PATH_XLS + "\\src\\test\\resources\\ANP_COMPLETA.xls";
	}
}